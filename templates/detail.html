{% extends 'base.html' %}
{% block title %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
  crossorigin="anonymous" referrerpolicy="no-referrer" />
<title>chatroom</title>
<style>
  @import url(/static/css/styles.css);
  /* 後で消す */
</style>
{% endblock %}
{% block body %}
<div class="main-container">
  <div class="chat-box">
    <div id="chat-header">
      <!-- もしuidとチャンネル作成者が同じならタイトル、説明を編集可能にする -->
      <p id="chatroom-name">{{ channel.name }}</p>
      {% if channel.abstract is not none %}
      <p id="chatroom-description">{{ channel.abstract }}</p>
      {% endif %}
      {% if uid == channel.uid %}
      <button id='channel-update' class="basic-btn smaller-btn">編集</button>
      {% include 'modal/update-channel.html' %}
      {% endif %}
    </div>
    <div id="message-area">
      {% if messages|length > 0 %}
      {% for message in messages %}
      {% if message.uid == uid %}
      <div class="my-messages">
        <p class="box box-right">{{ message.message }}</p>
        <form action="/delete_message" method="POST">
          <input type="hidden" value="{{ channel.id }}" name="channel_id" />
          <button class="delete-message-btn" name="message_id" value="{{ message.id }}">
            <ion-icon name="trash-bin-outline"></ion-icon>
          </button>
        </form>
      </div>
      {% else %}
      <div class="messages_box">

        <figure class="chat_user"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
            width="50" height="50" viewBox="0 0 24 24">
            <g fill="none" fill-rule="evenodd">
              <path d="M0 0h24v24H0z"></path>
              <path fill="#52B7AE"
                d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10s10-4.477 10-10S17.523 2 12 2ZM8.5 8.5a3.5 3.5 0 1 1 7 0a3.5 3.5 0 0 1-7 0Zm-3.222 7.84C6.927 14.992 9.335 14 12 14s5.073.992 6.722 2.34A7.993 7.993 0 0 1 12 20a7.993 7.993 0 0 1-6.722-3.66Z">
              </path>
            </g>
          </svg>
        </figure>

        <div class="messages">
          <p class="user-name">{{ message.user_name }}</p>
          <p class="box box-left">{{ message.message }}</p>
        </div>
      </div>
      {% endif %}
      {% endfor %}
      {% else %}
      <div>
        <p>まだメッセージがありません</p>
      </div>
      {% endif %}
    </div>
    <div class="typing-box-wrapper">
      <form class="typing-box" action="/message" method="POST">
        <textarea name="message" id="message" autofocus></textarea>
        <input type="hidden" name="channel_id" value="{{ channel.id }}" />
        <button type="submit" id="add-message-btn">
          <ion-icon name="paper-plane"></ion-icon>
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
{% block script %}
<script type="text/javascript">
  const channel = JSON.parse('{{ channel|tojson }}');
  const uid = JSON.parse('{{ uid|tojson }}');
</script>
<script src="{{url_for('static',filename='js/scroll-message.js')}}" type="text/javascript"></script>
<script src="{{url_for('static',filename='js/update-channel.js')}}" type="text/javascript"></script>
<script src="{{url_for('static',filename='js/modal.js')}}" type="text/javascript"></script>
{% endblock %}